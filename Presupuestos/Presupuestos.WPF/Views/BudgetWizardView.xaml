<UserControl x:Class="Presupuestos.WPF.Views.BudgetWizardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="12" Orientation="Vertical" >

            <!-- Encabezado -->
            <GroupBox Header="Presupuesto">
                <Grid Margin="8" ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="8">
                    <TextBox Grid.Column="0" Grid.Row="0"
                   Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                   materialDesign:HintAssist.Hint="Nombre del presupuesto"/>
                    <StackPanel Grid.Column="1" Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
                        <TextBlock Text="USD→ARS:" VerticalAlignment="Center"/>
                        <TextBox Width="120" Text="{Binding DollarRate, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N6}}"/>
                        <Button Content="Actualizar" Command="{Binding RefreshDollarCommand}"/>
                    </StackPanel>
                    <StackPanel Grid.Column="2" Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
                        <TextBlock Text="Beneficio %:" VerticalAlignment="Center"/>
                        <TextBox Width="80" Text="{Binding BenefitPercentage, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N2}}"/>
                    </StackPanel>

                    <!-- Cliente -->
                    <GroupBox Grid.ColumnSpan="3" Grid.Row="1" Header="Cliente">
                        <Grid Margin="8" ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="8">
                            <TextBox Grid.Column="0" Grid.Row="0" Text="{Binding ClientName}" materialDesign:HintAssist.Hint="Nombre / Razón social"/>
                            <TextBox Grid.Column="1" Grid.Row="0" Text="{Binding ClientEmail}" materialDesign:HintAssist.Hint="Email"/>
                            <TextBox Grid.Column="2" Grid.Row="0" Text="{Binding ClientPhone}" materialDesign:HintAssist.Hint="Teléfono"/>
                            <TextBox Grid.ColumnSpan="3" Grid.Row="1" Text="{Binding ClientAddress}" materialDesign:HintAssist.Hint="Dirección"/>
                        </Grid>
                    </GroupBox>
                </Grid>
            </GroupBox>

            <!-- Acciones rápidas -->
            <StackPanel Orientation="Horizontal" Margin="0,8,0,8" Spacing="8">
                <Button Content="Agregar materiales (picker)" Command="{Binding OpenMaterialPickerCommand}"/>
                <Button Content="Agregar mano de obra (picker)" Command="{Binding OpenLaborPickerCommand}"/>
                <Button Content="Importar subgrupo" Command="{Binding ImportSubgroupCommand}"/>
            </StackPanel>

            <!-- Materiales / Mano de obra seleccionados (lista unificada por orden) -->
            <DataGrid ItemsSource="{Binding Items}" AutoGenerateColumns="False" CanUserAddRows="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Tipo" Binding="{Binding Type}" Width="120"/>
                    <DataGridTextColumn Header="Descripción" Binding="{Binding MaterialName}" Width="*" />
                    <DataGridTextColumn Header="USD" Binding="{Binding PriceUSD, StringFormat={}{0:N2}}" Width="90"/>
                    <DataGridTextColumn Header="Cant." Binding="{Binding Quantity, StringFormat={}{0:N2}}" Width="90"/>
                    <DataGridTextColumn Header="MO Ítem" Binding="{Binding LaborItemName}" Width="180"/>
                    <DataGridTextColumn Header="Unit ARS" Binding="{Binding PriceARS, StringFormat={}{0:N6}}" Width="120"/>
                    <DataGridTextColumn Header="Cant. MO" Binding="{Binding LaborQuantity, StringFormat={}{0:N2}}" Width="90"/>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Costos manuales -->
            <StackPanel Orientation="Horizontal" Margin="0,8,0,0" Spacing="12">
                <CheckBox Content="Incluir honorarios" IsChecked="{Binding IncludeFees}"/>
                <TextBox Width="120" Text="{Binding FeesCost, StringFormat={}{0:N2}}" materialDesign:HintAssist.Hint="Honorarios ARS"/>
                <CheckBox Content="Incluir MO manual" IsChecked="{Binding IncludeLabor}"/>
                <TextBox Width="120" Text="{Binding LaborCost, StringFormat={}{0:N2}}" materialDesign:HintAssist.Hint="MO manual ARS"/>
            </StackPanel>

            <!-- Impuestos -->
            <GroupBox Header="Impuestos" Margin="0,8,0,0">
                <Grid Margin="8" ColumnDefinitions="*,*,*,*,*,*,*" ColumnSpacing="8">
                    <CheckBox Grid.Column="0" Content="Aplicar" IsChecked="{Binding Taxes.IncludeTaxes}"/>
                    <TextBox Grid.Column="1" Text="{Binding Taxes.IVA, StringFormat={}{0:N2}}" materialDesign:HintAssist.Hint="IVA %"/>
                    <TextBox Grid.Column="2" Text="{Binding Taxes.IVAT, StringFormat={}{0:N2}}" materialDesign:HintAssist.Hint="IVA T %"/>
                    <TextBox Grid.Column="3" Text="{Binding Taxes.IB, StringFormat={}{0:N2}}" materialDesign:HintAssist.Hint="IB %"/>
                    <TextBox Grid.Column="4" Text="{Binding Taxes.IG, StringFormat={}{0:N2}}" materialDesign:HintAssist.Hint="IG %"/>
                    <TextBox Grid.Column="5" Text="{Binding Taxes.IC, StringFormat={}{0:N2}}" materialDesign:HintAssist.Hint="IC %"/>
                    <TextBox Grid.Column="6" Text="{Binding Taxes.BankFees, StringFormat={}{0:N2}}" materialDesign:HintAssist.Hint="Bancos %"/>
                </Grid>
            </GroupBox>

            <!-- Acciones -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0" Spacing="8">
                <Button Content="Guardar" Command="{Binding SaveCommand}"/>
                <Button Content="Exportar PDF" Command="{Binding ExportPdfCommand}"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</UserControl>
